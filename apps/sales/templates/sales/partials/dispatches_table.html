<style>
    .dispatches-table {
        overflow-x: auto;
    }
    
    .dispatches-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .dispatches-table th {
        background: var(--color-gray-50);
        padding: var(--space-3);
        text-align: left;
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--color-gray-700);
        border-bottom: 2px solid var(--color-gray-200);
    }
    
    .dispatches-table td {
        padding: var(--space-3);
        border-bottom: 1px solid var(--color-gray-100);
        font-size: var(--text-sm);
    }
    
    .dispatches-table tr:hover {
        background: var(--color-gray-50);
    }
    
    .badge {
        display: inline-block;
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius);
        font-size: var(--text-xs);
        font-weight: 500;
    }
    
    .badge--success {
        background: var(--color-green-100);
        color: var(--color-green-800);
    }
    
    .badge--warning {
        background: var(--color-orange-100);
        color: var(--color-orange-800);
    }
    
    .action-buttons {
        display: flex;
        gap: var(--space-2);
    }
    
    .btn--sm {
        padding: var(--space-1) var(--space-3);
        font-size: var(--text-xs);
    }
    
    .empty-message {
        text-align: center;
        padding: var(--space-12);
        color: var(--color-gray-500);
    }
    
    .empty-message svg {
        width: 64px;
        height: 64px;
        margin: 0 auto var(--space-4);
        color: var(--color-gray-300);
    }
</style>

{% if dispatches %}
<div class="dispatches-table">
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Salesperson</th>
                <th>Products</th>
                <th>Crates</th>
                <th>Expected Revenue</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for dispatch in dispatches %}
            <tr>
                <td>{{ dispatch.date|date:"M d, Y" }}</td>
                <td>
                    <strong>{{ dispatch.salesperson.name }}</strong><br>
                    <small style="color: var(--color-gray-500);">{{ dispatch.salesperson.get_recipient_type_display }}</small>
                </td>
                <td>
                    {% for item in dispatch.dispatchitem_set.all %}
                        {{ item.product.name }}: {{ item.quantity }}
                        {% if not forloop.last %}<br>{% endif %}
                    {% endfor %}
                </td>
                <td>{{ dispatch.crates_dispatched }} crates</td>
                <td style="font-weight: 600; color: var(--color-success);">
                    KES {{ dispatch.expected_revenue|floatformat:2 }}
                </td>
                <td>
                    {% if dispatch.is_returned %}
                        <span class="badge badge--success">‚úÖ Returned</span>
                    {% else %}
                        <span class="badge badge--warning">‚è≥ Pending</span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{% url 'sales:dispatch_detail' dispatch.pk %}" class="btn btn--sm btn--primary">
                            üëÅÔ∏è View
                        </a>
                        {% if not dispatch.is_returned %}
                        <a href="{% url 'sales:dispatch_edit' dispatch.pk %}" class="btn btn--sm btn--secondary">
                            ‚úèÔ∏è Edit
                        </a>
                        <a href="{% url 'sales:return_create' dispatch.pk %}" class="btn btn--sm btn--success">
                            ‚Ü©Ô∏è Return
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div style="margin-top: var(--space-6); display: flex; justify-content: center; gap: var(--space-2);">
    {% if page_obj.has_previous %}
    <a href="?tab=dispatches&page={{ page_obj.previous_page_number }}&start_date={{ start_date|date:'Y-m-d' }}&end_date={{ end_date|date:'Y-m-d' }}&salesperson={{ selected_salesperson }}" class="btn btn--secondary">
        ‚Üê Previous
    </a>
    {% endif %}
    
    <span style="padding: var(--space-2) var(--space-4); color: var(--color-gray-600);">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>
    
    {% if page_obj.has_next %}
    <a href="?tab=dispatches&page={{ page_obj.next_page_number }}&start_date={{ start_date|date:'Y-m-d' }}&end_date={{ end_date|date:'Y-m-d' }}&salesperson={{ selected_salesperson }}" class="btn btn--secondary">
        Next ‚Üí
    </a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-message">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    <h3 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">No dispatches found</h3>
    <p>No dispatches match your filter criteria. Try adjusting the date range or salesperson filter.</p>
    <a href="{% url 'sales:dispatch_create' %}" class="btn btn--primary" style="margin-top: var(--space-4);">
        ‚ûï Create First Dispatch
    </a>
</div>
{% endif %}
